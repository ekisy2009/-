<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RestoPro â€” × ×™×”×•×œ ××¡×¢×“×” ×—×›×</title>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
/* â•â•â•â•â•â•â• DESIGN TOKENS â•â•â•â•â•â•â• */
:root {
  --bg:       #F7F7F8;
  --surface:  #FFFFFF;
  --sidebar:  #111318;
  --border:   #E8E8EC;
  --text:     #18181B;
  --text2:    #52525B;
  --text3:    #A1A1AA;
  --gold:     #F59E0B;
  --gold-d:   #D97706;
  --gold-bg:  #FFFBEB;
  --green:    #10B981;
  --green-bg: #ECFDF5;
  --red:      #EF4444;
  --red-bg:   #FEF2F2;
  --blue:     #3B82F6;
  --blue-bg:  #EFF6FF;
  --r:        10px;
  --r-lg:     16px;
  --sh:       0 1px 4px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
  --sh-md:    0 4px 20px rgba(0,0,0,.09);
  --sh-lg:    0 16px 48px rgba(0,0,0,.14);
  --sw:       240px;
  --th:       58px;
  --font:     'Heebo', sans-serif;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 15px; }
body { font-family: var(--font); background: var(--bg); color: var(--text);
       direction: rtl; -webkit-font-smoothing: antialiased; min-height: 100vh; }

/* â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â• */
.wrap { display: flex; min-height: 100vh; }
.main { margin-right: var(--sw); flex: 1; display: flex; flex-direction: column; }

/* â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â• */
.sb {
  width: var(--sw); background: var(--sidebar);
  position: fixed; right: 0; top: 0; bottom: 0;
  display: flex; flex-direction: column; z-index: 200;
}
/* golden glow at top */
.sb::before {
  content:''; position:absolute; top:0; left:0; right:0; height:120px;
  background: radial-gradient(ellipse 80% 60% at 50% -10%, rgba(245,158,11,.22), transparent);
  pointer-events: none;
}

/* Brand */
.sb-brand { padding: 22px 18px 16px; border-bottom: 1px solid rgba(255,255,255,.07); position: relative; z-index: 1; }
.sb-logo  { display:flex; align-items:center; gap:10px; }
.sb-icon  {
  width: 36px; height: 36px; border-radius: 9px; flex-shrink: 0;
  background: linear-gradient(135deg, var(--gold), #FCD34D);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; box-shadow: 0 3px 10px rgba(245,158,11,.4);
}
.sb-name  { font-size: 1.05rem; font-weight: 800; color: #fff; letter-spacing: -.2px; }
.sb-name  span { color: var(--gold); }
.sb-tag   { font-size: .62rem; color: rgba(255,255,255,.35); text-transform: uppercase; letter-spacing: .7px; margin-top: 1px; }

/* Nav */
.sb-nav { padding: 12px 8px; flex: 1; overflow-y: auto; }
.sb-sec { font-size: .6rem; font-weight: 700; color: rgba(255,255,255,.25);
          text-transform: uppercase; letter-spacing: 1.1px; padding: 10px 12px 4px; margin-top: 6px; }
.sb-btn {
  display: flex; align-items: center; gap: 9px;
  width: 100%; padding: 10px 12px; border-radius: 8px;
  color: rgba(255,255,255,.52); font-size: .855rem; font-weight: 500;
  font-family: var(--font); background: none; border: none;
  cursor: pointer; text-align: right; transition: all .16s; margin-bottom: 1px;
}
.sb-btn:hover  { background: rgba(255,255,255,.07); color: rgba(255,255,255,.88); }
.sb-btn.active { background: var(--gold); color: #111; font-weight: 700;
                 box-shadow: 0 3px 10px rgba(245,158,11,.38); }
.sb-ico { font-size: .9rem; width: 18px; text-align: center; flex-shrink: 0; }

/* Footer */
.sb-foot { padding: 12px 16px; border-top: 1px solid rgba(255,255,255,.07); display:flex; align-items:center; gap:8px; }
.api-dot { width: 7px; height: 7px; border-radius: 50%; background: rgba(255,255,255,.18); flex-shrink:0; }
.api-dot.ok { background: var(--green); box-shadow: 0 0 7px rgba(16,185,129,.7); animation: blink 2s infinite; }
.api-lbl { font-size: .7rem; color: rgba(255,255,255,.38); }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:.45} }

/* â•â•â•â•â•â•â• TOPBAR â•â•â•â•â•â•â• */
.topbar {
  height: var(--th); background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 0 26px; display: flex; align-items: center;
  justify-content: space-between;
  position: sticky; top: 0; z-index: 100; box-shadow: var(--sh);
}
.tb-crumb { font-size: .77rem; color: var(--text3); display:flex; align-items:center; gap:5px; }
.tb-crumb b { color: var(--text); font-weight: 700; }
.tb-date  { font-size: .73rem; color: var(--text3); background: var(--bg);
            padding: 4px 11px; border-radius: 20px; border: 1px solid var(--border); }

/* â•â•â•â•â•â•â• PAGE BODY â•â•â•â•â•â•â• */
.body { padding: 24px 26px; flex: 1; }
.page { display:none; }
.page.active { display:block; animation: fadeUp .2s ease; }
@keyframes fadeUp { from{opacity:0;transform:translateY(7px)} to{opacity:1;transform:none} }

/* â•â•â•â•â•â•â• PAGE HEADER â•â•â•â•â•â•â• */
.ph { display:flex; align-items:flex-start; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:20px; }
.ph-t { font-size: 1.5rem; font-weight: 800; letter-spacing: -.4px; }
.ph-s { font-size: .8rem; color: var(--text2); margin-top:3px; }
.ph-r { display:flex; gap:7px; }

/* â•â•â•â•â•â•â• BUTTONS â•â•â•â•â•â•â• */
.btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 8px 17px; border-radius: var(--r);
  font-size: .83rem; font-weight: 600; cursor: pointer;
  font-family: var(--font); border: none; white-space: nowrap; transition: all .16s;
}
.btn-gold  { background: var(--gold); color: #111; box-shadow: 0 2px 8px rgba(245,158,11,.3); }
.btn-gold:hover { background: var(--gold-d); transform: translateY(-1px); box-shadow: 0 4px 14px rgba(245,158,11,.4); }
.btn-out   { background: transparent; color: var(--text2); border: 1.5px solid var(--border); }
.btn-out:hover   { border-color: var(--text3); background: var(--bg); }
.btn-ghost { background: transparent; color: var(--text3); padding: 7px 10px; }
.btn-ghost:hover { background: var(--bg); color: var(--text); }
.btn-red   { background: transparent; color: var(--red); border: 1.5px solid #FECACA; }
.btn-red:hover   { background: var(--red-bg); }
.btn-sm    { padding: 6px 11px; font-size: .76rem; }
.btn:disabled { opacity: .4; cursor: not-allowed; transform: none !important; }

/* spinner */
.spin { width:14px;height:14px; border:2px solid rgba(0,0,0,.15); border-top-color: #111;
        border-radius:50%; animation:rot .6s linear infinite; display:none; flex-shrink:0; }
.btn.loading .spin { display:block; }
.btn.loading .lbl  { opacity:.65; }
@keyframes rot { to{transform:rotate(360deg)} }

/* â•â•â•â•â•â•â• KPI STRIP â•â•â•â•â•â•â• */
.kpis { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:20px; }
.kpi  {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--r-lg); padding: 17px 19px;
  box-shadow: var(--sh); transition: all .18s; position:relative; overflow:hidden;
}
.kpi:hover { transform:translateY(-2px); box-shadow:var(--sh-md); }
.kpi-bar { position:absolute; bottom:0;left:0;right:0;height:3px; }
.kpi-bar.gold  { background:linear-gradient(90deg,var(--gold),#FDE68A); }
.kpi-bar.green { background:linear-gradient(90deg,var(--green),#6EE7B7); }
.kpi-bar.red   { background:linear-gradient(90deg,var(--red),#FCA5A5); }
.kpi-bar.blue  { background:linear-gradient(90deg,var(--blue),#93C5FD); }
.kpi-icon  { font-size:1.35rem; margin-bottom:8px; }
.kpi-val   { font-size:1.7rem; font-weight:800; letter-spacing:-.4px; line-height:1; }
.kpi-label { font-size:.74rem; color:var(--text2); margin-top:4px; font-weight:500; }
.kpi-sub   { display:inline-block; margin-top:7px; padding:2px 9px; border-radius:20px; font-size:.67rem; font-weight:700; }
.ks-gold   { background:var(--gold-bg); color:var(--gold-d); }
.ks-green  { background:var(--green-bg); color:#059669; }
.ks-red    { background:var(--red-bg); color:#DC2626; }
.ks-blue   { background:var(--blue-bg); color:#2563EB; }

/* â•â•â•â•â•â•â• CARD â•â•â•â•â•â•â• */
.card { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); box-shadow:var(--sh); }
.card-hd  { padding:14px 17px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
.card-hd-t { font-size:.8rem; font-weight:700; color:var(--text2); display:flex; align-items:center; gap:6px; }
.card-body { padding:16px; }

/* â•â•â•â•â•â•â• GRIDS â•â•â•â•â•â•â• */
.g2 { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:18px; }

/* â•â•â•â•â•â•â• TABLE CARD â•â•â•â•â•â•â• */
.tbl-wrap { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); box-shadow:var(--sh); overflow:hidden; }
.tbl-top  { padding:13px 17px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:8px; }
.tbl-title { font-weight:700; font-size:.9rem; }
.tbl-filters { display:flex; gap:7px; flex-wrap:wrap; }

.fi { background:var(--bg); border:1.5px solid var(--border); border-radius:var(--r); padding:7px 11px;
      font-size:.79rem; color:var(--text); font-family:var(--font); outline:none; transition:all .16s; direction:rtl; }
.fi:focus { border-color:var(--gold); background:var(--surface); box-shadow:0 0 0 3px rgba(245,158,11,.1); }
.fi::placeholder { color:var(--text3); }

table { width:100%; border-collapse:collapse; font-size:.83rem; }
thead th { padding:10px 14px; text-align:right; font-size:.68rem; font-weight:700; color:var(--text3);
           text-transform:uppercase; letter-spacing:.4px; background:var(--bg); border-bottom:1px solid var(--border); white-space:nowrap; }
tbody td  { padding:11px 14px; border-bottom:1px solid #F4F4F5; color:var(--text2); vertical-align:middle; }
tbody tr:last-child td { border-bottom:none; }
tbody tr:hover td { background:#FAFAFA; }
.amt { font-weight:700; color:var(--text); }

/* â•â•â•â•â•â•â• TAGS â•â•â•â•â•â•â• */
.tag { display:inline-flex; align-items:center; padding:3px 9px; border-radius:20px; font-size:.69rem; font-weight:600; }
.tag-v { background:#D1FAE5; color:#065F46; }
.tag-m { background:#FEE2E2; color:#991B1B; }
.tag-d { background:#DBEAFE; color:#1D4ED8; }
.tag-l { background:#FEF3C7; color:#92400E; }
.tag-o { background:#F4F4F5; color:var(--text2); }

.stag { padding:3px 9px; border-radius:6px; font-size:.69rem; font-weight:700; }
.st-draft    { background:#FEF9C3; color:#713F12; }
.st-sent     { background:#DBEAFE; color:#1D4ED8; }
.st-received { background:#D1FAE5; color:#065F46; }

/* â•â•â•â•â•â•â• ICON BUTTONS â•â•â•â•â•â•â• */
.ib { width:28px;height:28px; border-radius:7px; border:1px solid var(--border);
      background:transparent; cursor:pointer; display:inline-flex; align-items:center; justify-content:center;
      font-size:.8rem; transition:all .15s; margin-left:2px; }
.ib:hover { background:var(--bg); border-color:var(--text3); }
.ib.del:hover { background:var(--red-bg); border-color:#FECACA; }

/* â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â• */
.overlay { position:fixed; inset:0; background:rgba(17,19,24,.55); backdrop-filter:blur(4px);
           z-index:500; display:flex; align-items:center; justify-content:center; padding:14px;
           opacity:0; pointer-events:none; transition:opacity .18s; }
.overlay.open { opacity:1; pointer-events:all; }
.modal { background:var(--surface); border-radius:var(--r-lg); box-shadow:var(--sh-lg);
         width:100%; max-width:500px; max-height:92vh; overflow-y:auto;
         transform:translateY(10px) scale(.98); transition:transform .2s; }
.overlay.open .modal { transform:none; }
.modal.lg { max-width:590px; }
.m-hd { padding:19px 21px 15px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
.m-title { font-size:.98rem; font-weight:800; }
.m-x  { width:29px;height:29px;border-radius:7px;border:none;background:var(--bg);cursor:pointer;
         font-size:1rem;display:flex;align-items:center;justify-content:center;color:var(--text2); transition:background .14s; }
.m-x:hover { background:var(--border); }
.m-body { padding:19px 21px; }
.m-foot { padding:13px 21px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:7px; }

/* â•â•â•â•â•â•â• FORM â•â•â•â•â•â•â• */
.fg   { margin-bottom:13px; }
.fr   { display:grid; grid-template-columns:1fr 1fr; gap:11px; }
.fl   { display:block; font-size:.77rem; font-weight:600; color:var(--text2); margin-bottom:5px; }
.fl .r{ color:var(--red); margin-right:1px; }
.fc   { width:100%; background:var(--bg); border:1.5px solid var(--border); border-radius:var(--r);
        padding:9px 12px; font-size:.865rem; color:var(--text); font-family:var(--font);
        outline:none; transition:all .16s; direction:rtl; }
.fc:focus { border-color:var(--gold); background:var(--surface); box-shadow:0 0 0 3px rgba(245,158,11,.1); }
.fc::placeholder { color:var(--text3); }

/* â•â•â•â•â•â•â• UPLOAD ZONE â•â•â•â•â•â•â• */
.upz { border:2px dashed var(--border); border-radius:var(--r-lg); padding:22px 18px;
       text-align:center; cursor:pointer; background:var(--bg); transition:all .18s; position:relative; overflow:hidden; }
.upz:hover { border-color:var(--gold); background:rgba(245,158,11,.04); }
.upz input { position:absolute;inset:0;opacity:0;cursor:pointer; }
.upz-i { font-size:1.7rem; margin-bottom:6px; }
.upz-t { font-size:.82rem; color:var(--text3); }
.upz-cta { font-size:.78rem; color:var(--gold); font-weight:700; margin-top:2px; }

/* â•â•â•â•â•â•â• AI ITEM ROW â•â•â•â•â•â•â• */
.ai-row { display:grid; grid-template-columns:2fr 1fr 1fr 1fr auto; gap:5px; margin-bottom:6px;
          align-items:center; padding:8px 10px; background:var(--bg); border-radius:var(--r); border:1px solid var(--border); }

/* â•â•â•â•â•â•â• ORDER CARDS â•â•â•â•â•â•â• */
.ord-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:14px; }
.ord-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); padding:16px 17px; box-shadow:var(--sh); transition:all .18s; }
.ord-card:hover { transform:translateY(-2px); box-shadow:var(--sh-md); }
.ord-top  { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:11px; }
.ord-sup  { font-weight:800; font-size:.93rem; }
.ord-dt   { font-size:.71rem; color:var(--text3); margin-top:2px; }
.ord-line { display:flex; justify-content:space-between; font-size:.79rem; color:var(--text2);
            padding:4px 0; border-bottom:1px dashed #EFEFEF; }
.ord-line:last-child { border-bottom:none; }
.ord-total { display:flex; justify-content:space-between; align-items:center;
             margin-top:10px; padding-top:10px; border-top:1px solid var(--border); }
.ord-tl { font-size:.71rem; font-weight:600; color:var(--text3); }
.ord-tv { font-size:.97rem; font-weight:800; }
.ord-acts { display:flex; gap:5px; margin-top:11px; }

/* â•â•â•â•â•â•â• SUPPLIER CARDS â•â•â•â•â•â•â• */
.sup-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:14px; }
.sup-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); padding:18px; box-shadow:var(--sh); transition:all .18s; }
.sup-card:hover { transform:translateY(-2px); box-shadow:var(--sh-md); }
.sup-av   { width:42px;height:42px;border-radius:10px; background:linear-gradient(135deg,var(--gold),#FDE68A);
            display:flex;align-items:center;justify-content:center;font-size:1.2rem; margin-bottom:12px;
            box-shadow:0 3px 10px rgba(245,158,11,.25); }
.sup-name { font-size:.94rem; font-weight:800; }
.sup-meta { font-size:.74rem; color:var(--text3); margin-top:2px; }
.sup-tot  { display:flex; justify-content:space-between; align-items:center;
            margin-top:12px; padding-top:12px; border-top:1px solid var(--border); }
.sup-tl   { font-size:.69rem; font-weight:600; color:var(--text3); }
.sup-tv   { font-size:.86rem; font-weight:800; color:var(--green); }
.sup-acts { display:flex; gap:5px; margin-top:11px; }

/* â•â•â•â•â•â•â• SETTINGS â•â•â•â•â•â•â• */
.set-wrap { max-width:540px; }
.set-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg);
            padding:19px 21px; box-shadow:var(--sh); margin-bottom:13px; }
.set-ct { font-size:.86rem; font-weight:800; margin-bottom:3px; display:flex; align-items:center; gap:6px; }
.set-cd { font-size:.75rem; color:var(--text3); margin-bottom:13px; }
.toast  { display:inline-flex; align-items:center; gap:5px; background:var(--green-bg); color:#059669;
          border:1px solid #A7F3D0; padding:6px 12px; border-radius:8px; font-size:.75rem; font-weight:600;
          margin-top:8px; opacity:0; transition:opacity .22s; }
.toast.show { opacity:1; }

/* â•â•â•â•â•â•â• API BANNER â•â•â•â•â•â•â• */
.banner { background:var(--gold-bg); border:1px solid #FDE68A; border-radius:var(--r-lg);
          padding:10px 15px; margin-bottom:18px; display:flex; align-items:center; gap:10px;
          font-size:.79rem; color:#78350F; }
.banner a { color:var(--gold-d); font-weight:700; cursor:pointer; }

/* â•â•â•â•â•â•â• EMPTY STATE â•â•â•â•â•â•â• */
.empty { text-align:center; padding:50px 16px; color:var(--text3); }
.empty-i { font-size:2.3rem; display:block; margin-bottom:11px; opacity:.5; }
.empty-t { font-size:.94rem; font-weight:700; color:var(--text2); margin-bottom:5px; }
.empty-s { font-size:.79rem; margin-bottom:15px; }

/* â•â•â•â•â•â•â• SCROLLBAR â•â•â•â•â•â•â• */
::-webkit-scrollbar { width:5px;height:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }

/* â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â• */
@media(max-width:1060px) { .kpis{grid-template-columns:1fr 1fr;} .g2{grid-template-columns:1fr;} }
@media(max-width:720px)  {
  :root { --sw:0px; }
  .sb { display:none; }
  .kpis { grid-template-columns:1fr 1fr; }
  .body { padding:14px; }
}
</style>
</head>
<body>
<div class="wrap">

<!-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ SIDEBAR â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ -->
<aside class="sb">
  <div class="sb-brand">
    <div class="sb-logo">
      <div class="sb-icon">ğŸ½ï¸</div>
      <div>
        <div class="sb-name">Resto<span>Pro</span></div>
        <div class="sb-tag">Restaurant Manager</div>
      </div>
    </div>
  </div>

  <nav class="sb-nav">
    <div class="sb-sec">×¨××©×™</div>
    <button class="sb-btn active" data-page="dashboard" onclick="go('dashboard')">
      <span class="sb-ico">ğŸ“Š</span> ×“×©×‘×•×¨×“
    </button>
    <div class="sb-sec">× ×™×”×•×œ</div>
    <button class="sb-btn" data-page="expenses" onclick="go('expenses')">
      <span class="sb-ico">ğŸ’°</span> ××¢×§×‘ ×”×•×¦××•×ª
    </button>
    <button class="sb-btn" data-page="orders" onclick="go('orders')">
      <span class="sb-ico">ğŸ›’</span> ×”×–×× ×•×ª ×¡×¤×§×™×
    </button>
    <button class="sb-btn" data-page="suppliers" onclick="go('suppliers')">
      <span class="sb-ico">ğŸšš</span> ×¡×¤×§×™×
    </button>
    <div class="sb-sec">××¢×¨×›×ª</div>
    <button class="sb-btn" data-page="settings" onclick="go('settings')">
      <span class="sb-ico">âš™ï¸</span> ×”×’×“×¨×•×ª
    </button>
  </nav>

  <div class="sb-foot">
    <div class="api-dot" id="apiDot"></div>
    <span class="api-lbl" id="apiLbl">Claude API ×œ× ××•×’×“×¨</span>
  </div>
</aside>

<!-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ MAIN â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ -->
<div class="main">

  <!-- Topbar -->
  <header class="topbar">
    <div class="tb-crumb">RestoPro &rsaquo; <b id="pgName">×“×©×‘×•×¨×“</b></div>
    <div class="tb-date" id="tDate"></div>
  </header>

  <div class="body">

    <!-- API Banner -->
    <div class="banner" id="apiBanner">
      ğŸ”‘&nbsp;× ×“×¨×© ××¤×ª×— Claude API ×œ× ×™×ª×•×— ×ª××•× ×•×ª ×ª×¤×¨×™×˜.
      <a onclick="go('settings')">×”×’×“×¨ ×¢×›×©×™×• â†’</a>
      <button class="btn btn-ghost btn-sm" style="margin-right:auto;padding:3px 8px" onclick="this.closest('.banner').remove()">âœ•</button>
    </div>

    <!-- â•â•â•â• DASHBOARD â•â•â•â• -->
    <div class="page active" id="page-dashboard">
      <div class="ph">
        <div>
          <div class="ph-t">×©×œ×•×, ×‘×¨×•×š ×”×‘× ğŸ‘‹</div>
          <div class="ph-s">×¡×™×›×•× ×¤×¢×™×œ×•×ª ×”××¡×¢×“×” ×©×œ×š</div>
        </div>
        <div class="ph-r">
          <button class="btn btn-gold" onclick="go('expenses');setTimeout(openExpModal,80)">+ ×”×•×¦××” ×—×“×©×”</button>
        </div>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="kpi-bar gold"></div>
          <div class="kpi-icon">ğŸ’°</div>
          <div class="kpi-val" id="kM">â‚ª0</div>
          <div class="kpi-label">×”×•×¦××•×ª ×”×—×•×“×©</div>
          <div class="kpi-sub ks-gold" id="kMsub">â€”</div>
        </div>
        <div class="kpi"><div class="kpi-bar green"></div>
          <div class="kpi-icon">ğŸ“…</div>
          <div class="kpi-val" id="kD">â‚ª0</div>
          <div class="kpi-label">×”×•×¦××•×ª ×”×™×•×</div>
          <div class="kpi-sub ks-green">×”×™×•×</div>
        </div>
        <div class="kpi"><div class="kpi-bar red"></div>
          <div class="kpi-icon">ğŸ›’</div>
          <div class="kpi-val" id="kO">0</div>
          <div class="kpi-label">×”×–×× ×•×ª ×¤×ª×•×—×•×ª</div>
          <div class="kpi-sub ks-red">×××ª×™× ×•×ª</div>
        </div>
        <div class="kpi"><div class="kpi-bar blue"></div>
          <div class="kpi-icon">ğŸ†</div>
          <div class="kpi-val" id="kS" style="font-size:1rem">â€”</div>
          <div class="kpi-label">×¡×¤×§ ××•×‘×™×œ</div>
          <div class="kpi-sub ks-blue" id="kSa"></div>
        </div>
      </div>

      <div class="g2">
        <div class="card">
          <div class="card-hd"><div class="card-hd-t">ğŸ“ˆ ×”×•×¦××•×ª 6 ×—×•×“×©×™× ××—×¨×•× ×™×</div></div>
          <div class="card-body"><canvas id="cBar" height="200"></canvas></div>
        </div>
        <div class="card">
          <div class="card-hd"><div class="card-hd-t">ğŸ• ×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”</div></div>
          <div class="card-body"><canvas id="cDon" height="200"></canvas></div>
        </div>
      </div>

      <div class="tbl-wrap">
        <div class="tbl-top">
          <div class="tbl-title">×”×•×¦××•×ª ××—×¨×•× ×•×ª</div>
          <button class="btn btn-out btn-sm" onclick="go('expenses')">×”×¦×’ ×”×›×œ â†’</button>
        </div>
        <div style="overflow-x:auto">
          <table>
            <thead><tr><th>×ª××¨×™×š</th><th>×¡×¤×§</th><th>×§×˜×’×•×¨×™×”</th><th>×ª×™××•×¨</th><th>×¡×›×•×</th></tr></thead>
            <tbody id="recentBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â•â•â• EXPENSES â•â•â•â• -->
    <div class="page" id="page-expenses">
      <div class="ph">
        <div>
          <div class="ph-t">××¢×§×‘ ×”×•×¦××•×ª ğŸ’°</div>
          <div class="ph-s">× ×™×”×•×œ ×›×œ ×”×”×•×¦××•×ª ×©×œ ×”××¡×¢×“×”</div>
        </div>
        <div class="ph-r">
          <button class="btn btn-out" onclick="exportCSV()">â¬‡ CSV</button>
          <button class="btn btn-gold" onclick="openExpModal()">+ ×”×•×¦××” ×—×“×©×”</button>
        </div>
      </div>
      <div class="tbl-wrap">
        <div class="tbl-top">
          <div class="tbl-title" id="expCount">×”×•×¦××•×ª</div>
          <div class="tbl-filters">
            <input type="month" class="fi" id="fMonth" onchange="renderExp()">
            <select class="fi" id="fCat" onchange="renderExp()">
              <option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
              <option>×™×¨×§×•×ª ×•×¤×™×¨×•×ª</option><option>×‘×©×¨ ×•×¢×•×£</option>
              <option>××©×§××•×ª</option><option>××•×¦×¨×™ ×—×œ×‘</option><option>××—×¨</option>
            </select>
            <input type="text" class="fi" id="fQ" placeholder="ğŸ” ×—×™×¤×•×©..." oninput="renderExp()">
          </div>
        </div>
        <div style="overflow-x:auto">
          <table>
            <thead><tr><th>×ª××¨×™×š</th><th>×¡×¤×§</th><th>×§×˜×’×•×¨×™×”</th><th>×ª×™××•×¨</th><th>×¡×›×•×</th><th>×¤×¢×•×œ×•×ª</th></tr></thead>
            <tbody id="expBody"></tbody>
          </table>
        </div>
        <div id="expEmpty" class="empty" style="display:none">
          <span class="empty-i">ğŸ“‹</span>
          <div class="empty-t">××™×Ÿ ×”×•×¦××•×ª</div>
          <div class="empty-s">×”×•×¡×£ ×”×•×¦××” ×¨××©×•× ×”</div>
          <button class="btn btn-gold" onclick="openExpModal()">+ ×”×•×¦××” ×—×“×©×”</button>
        </div>
      </div>
    </div>

    <!-- â•â•â•â• ORDERS â•â•â•â• -->
    <div class="page" id="page-orders">
      <div class="ph">
        <div>
          <div class="ph-t">×”×–×× ×•×ª ×¡×¤×§×™× ğŸ›’</div>
          <div class="ph-s">×”×–×× ×” ×™×“× ×™×ª ××• × ×™×ª×•×— ×ª×¤×¨×™×˜ ×¢× AI</div>
        </div>
        <div class="ph-r">
          <button class="btn btn-out" onclick="openAIOrder()">ğŸ“· ×”×–×× ×” ××ª××•× ×”</button>
          <button class="btn btn-gold" onclick="openManualOrder()">+ ×”×–×× ×” ×™×“× ×™×ª</button>
        </div>
      </div>
      <div class="ord-grid" id="ordGrid"></div>
      <div id="ordEmpty" class="empty" style="display:none">
        <span class="empty-i">ğŸ›’</span>
        <div class="empty-t">××™×Ÿ ×”×–×× ×•×ª ×¢×“×™×™×Ÿ</div>
        <div class="empty-s">×¦×•×¨ ×”×–×× ×” ×™×“× ×™×ª ××• ×”×¢×œ×” ×ª××•× ×ª ×ª×¤×¨×™×˜</div>
        <button class="btn btn-gold" onclick="openManualOrder()">+ ×”×–×× ×” ×™×“× ×™×ª</button>
      </div>
    </div>

    <!-- â•â•â•â• SUPPLIERS â•â•â•â• -->
    <div class="page" id="page-suppliers">
      <div class="ph">
        <div>
          <div class="ph-t">× ×™×”×•×œ ×¡×¤×§×™× ğŸšš</div>
          <div class="ph-s">×›×œ ×”×¡×¤×§×™× ×©×œ ×”××¡×¢×“×”</div>
        </div>
        <button class="btn btn-gold" onclick="openSupModal()">+ ×¡×¤×§ ×—×“×©</button>
      </div>
      <div class="sup-grid" id="supGrid"></div>
      <div id="supEmpty" class="empty" style="display:none">
        <span class="empty-i">ğŸšš</span>
        <div class="empty-t">××™×Ÿ ×¡×¤×§×™× ×¢×“×™×™×Ÿ</div>
        <div class="empty-s">×”×•×¡×£ ×¡×¤×§ ×¨××©×•×Ÿ</div>
        <button class="btn btn-gold" onclick="openSupModal()">+ ×¡×¤×§ ×—×“×©</button>
      </div>
    </div>

    <!-- â•â•â•â• SETTINGS â•â•â•â• -->
    <div class="page" id="page-settings">
      <div class="ph">
        <div>
          <div class="ph-t">×”×’×“×¨×•×ª âš™ï¸</div>
          <div class="ph-s">××¤×ª×— API ×•×”×’×“×¨×•×ª ××¢×¨×›×ª</div>
        </div>
      </div>
      <div class="set-wrap">
        <div class="set-card">
          <div class="set-ct">ğŸ¤– Claude API</div>
          <div class="set-cd">× ×“×¨×© ×œ× ×™×ª×•×— ×ª××•× ×•×ª ×ª×¤×¨×™×˜. ×”××¤×ª×— × ×©××¨ ×‘×“×¤×“×¤×Ÿ ×‘×œ×‘×“.</div>
          <div class="fg">
            <label class="fl">××¤×ª×— API</label>
            <input type="password" class="fc" id="apiIn" placeholder="sk-ant-api...">
          </div>
          <button class="btn btn-gold" onclick="saveKey()">×©××•×¨ ××¤×ª×—</button>
          <div class="toast" id="keyToast">âœ“ × ×©××¨ ×‘×”×¦×œ×—×”!</div>
        </div>
        <div class="set-card">
          <div class="set-ct">ğŸ¤– ××•×“×œ</div>
          <div class="set-cd">×”××•×“×œ ×”××©××© ×œ× ×™×ª×•×— ×ª××•× ×•×ª ×ª×¤×¨×™×˜</div>
          <input class="fc" value="claude-sonnet-4-6" readonly style="opacity:.5">
        </div>
        <div class="set-card">
          <div class="set-ct">ğŸ—‘ï¸ ××™×¤×•×¡ × ×ª×•× ×™×</div>
          <div class="set-cd">××—×§ ××ª ×›×œ ×”× ×ª×•× ×™× â€” ×¤×¢×•×œ×” ×‘×œ×ª×™ ×”×¤×™×›×”.</div>
          <button class="btn btn-red" onclick="nukeData()">××—×§ ×”×›×œ</button>
        </div>
      </div>
    </div>

  </div><!-- body -->
</div><!-- main -->
</div><!-- wrap -->

<!-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ MODALS â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ -->

<!-- Expense Modal -->
<div class="overlay" id="ovExp">
  <div class="modal">
    <div class="m-hd">
      <div class="m-title" id="expModalTitle">×”×•×¦××” ×—×“×©×”</div>
      <button class="m-x" onclick="cm('ovExp')">âœ•</button>
    </div>
    <div class="m-body">
      <input type="hidden" id="eEditId">
      <div class="fr">
        <div class="fg"><label class="fl">×ª××¨×™×š <span class="r">*</span></label><input type="date" class="fc" id="eDate"></div>
        <div class="fg"><label class="fl">×¡×›×•× â‚ª <span class="r">*</span></label><input type="number" class="fc" id="eAmt" placeholder="0.00" min="0" step="0.01"></div>
      </div>
      <div class="fg">
        <label class="fl">×¡×¤×§ <span class="r">*</span></label>
        <input type="text" class="fc" id="eSupp" placeholder="×©× ×”×¡×¤×§" list="dlSupp">
        <datalist id="dlSupp"></datalist>
      </div>
      <div class="fg">
        <label class="fl">×§×˜×’×•×¨×™×”</label>
        <select class="fc" id="eCat">
          <option>×™×¨×§×•×ª ×•×¤×™×¨×•×ª</option><option>×‘×©×¨ ×•×¢×•×£</option>
          <option>××©×§××•×ª</option><option>××•×¦×¨×™ ×—×œ×‘</option><option>××—×¨</option>
        </select>
      </div>
      <div class="fg"><label class="fl">×ª×™××•×¨</label><input type="text" class="fc" id="eDesc" placeholder="×ª×™××•×¨ ×§×¦×¨..."></div>
    </div>
    <div class="m-foot">
      <button class="btn btn-out" onclick="cm('ovExp')">×‘×™×˜×•×œ</button>
      <button class="btn btn-gold" onclick="saveExp()">ğŸ’¾ ×©××•×¨</button>
    </div>
  </div>
</div>

<!-- Manual Order Modal -->
<div class="overlay" id="ovMan">
  <div class="modal lg">
    <div class="m-hd">
      <div class="m-title">×”×–×× ×” ×™×“× ×™×ª</div>
      <button class="m-x" onclick="cm('ovMan')">âœ•</button>
    </div>
    <div class="m-body">
      <div class="fr">
        <div class="fg">
          <label class="fl">×¡×¤×§ <span class="r">*</span></label>
          <input type="text" class="fc" id="manSupp" list="dlSupp2">
          <datalist id="dlSupp2"></datalist>
        </div>
        <div class="fg"><label class="fl">×ª××¨×™×š</label><input type="date" class="fc" id="manDate"></div>
      </div>
      <div class="fg">
        <label class="fl">×¤×¨×™×˜×™×</label>
        <div id="manItems"></div>
        <button class="btn btn-out btn-sm" onclick="addManRow()" style="margin-top:7px">+ ×”×•×¡×£ ×¤×¨×™×˜</button>
      </div>
      <div style="text-align:left;font-weight:700;font-size:.9rem;margin-top:5px" id="manTot">×¡×”"×›: â‚ª0</div>
    </div>
    <div class="m-foot">
      <button class="btn btn-out" onclick="cm('ovMan')">×‘×™×˜×•×œ</button>
      <button class="btn btn-out" onclick="saveManOrder('draft')">ğŸ’¾ ×˜×™×•×˜×”</button>
      <button class="btn btn-gold" onclick="saveManOrder('sent')">âœ‰ï¸ ×©×œ×—</button>
    </div>
  </div>
</div>

<!-- AI Order Modal -->
<div class="overlay" id="ovAI">
  <div class="modal lg">
    <div class="m-hd">
      <div class="m-title">ğŸ¤– ×”×–×× ×” ×œ×¤×™ × ×™×ª×•×— ×ª××•× ×”</div>
      <button class="m-x" onclick="cm('ovAI')">âœ•</button>
    </div>
    <div class="m-body">
      <div class="fg">
        <label class="fl">×¡×¤×§</label>
        <input type="text" class="fc" id="aiSupp" list="dlSupp3">
        <datalist id="dlSupp3"></datalist>
      </div>
      <div class="upz" id="upZone" style="margin-bottom:11px">
        <input type="file" id="menuFile" accept="image/*" onchange="prevImg(this)">
        <div class="upz-i">ğŸ“·</div>
        <div class="upz-t">×œ×—×¥ ×œ×”×¢×œ××ª ×ª××•× ×ª ×ª×¤×¨×™×˜ ×¡×¤×§</div>
        <div class="upz-cta">JPG Â· PNG Â· WEBP</div>
      </div>
      <img id="prevPic" style="display:none;max-width:100%;border-radius:10px;margin-bottom:11px;border:1px solid var(--border)">
      <button class="btn btn-gold" id="analyzeBtn" onclick="runAI()" disabled
              style="width:100%;justify-content:center;margin-bottom:13px">
        <div class="spin"></div><span class="lbl">âœ¨ × ×ª×— ×¢× Claude AI</span>
      </button>
      <div id="aiRes" style="display:none">
        <label class="fl" style="margin-bottom:7px">×¤×¨×™×˜×™× ×©×–×•×”×• â€“ ×¢×¨×•×š ×œ×¤×™ ×”×¦×•×¨×š:</label>
        <div id="aiList"></div>
        <div style="text-align:left;font-weight:700;font-size:.9rem;margin-top:8px" id="aiTot">×¡×”"×›: â‚ª0</div>
      </div>
    </div>
    <div class="m-foot">
      <button class="btn btn-out" onclick="cm('ovAI')">×‘×™×˜×•×œ</button>
      <button class="btn btn-gold" id="aiConfirm" onclick="confirmAIOrder()" style="display:none">âœ… ××©×¨ ×”×–×× ×”</button>
    </div>
  </div>
</div>

<!-- Supplier Modal -->
<div class="overlay" id="ovSup">
  <div class="modal">
    <div class="m-hd">
      <div class="m-title" id="supModalTitle">×¡×¤×§ ×—×“×©</div>
      <button class="m-x" onclick="cm('ovSup')">âœ•</button>
    </div>
    <div class="m-body">
      <input type="hidden" id="supEditId">
      <div class="fg"><label class="fl">×©× ×”×¡×¤×§ <span class="r">*</span></label><input type="text" class="fc" id="sName" placeholder="×©× ×”×¡×¤×§"></div>
      <div class="fr">
        <div class="fg">
          <label class="fl">×§×˜×’×•×¨×™×”</label>
          <select class="fc" id="sCat">
            <option>×™×¨×§×•×ª ×•×¤×™×¨×•×ª</option><option>×‘×©×¨ ×•×¢×•×£</option>
            <option>××©×§××•×ª</option><option>××•×¦×¨×™ ×—×œ×‘</option><option>××—×¨</option>
          </select>
        </div>
        <div class="fg"><label class="fl">×˜×œ×¤×•×Ÿ</label><input type="tel" class="fc" id="sPhone" placeholder="050-0000000"></div>
      </div>
      <div class="fg"><label class="fl">××™×© ×§×©×¨</label><input type="text" class="fc" id="sContact" placeholder="×©× ××™×© ×§×©×¨"></div>
    </div>
    <div class="m-foot">
      <button class="btn btn-out" onclick="cm('ovSup')">×‘×™×˜×•×œ</button>
      <button class="btn btn-gold" onclick="saveSup()">ğŸ’¾ ×©××•×¨</button>
    </div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let DB = { expenses:[], orders:[], suppliers:[], apiKey:'' };

function loadDB() {
  const raw = localStorage.getItem('restopro_v3');
  if (raw) { DB = JSON.parse(raw); }
  else seed();
}

function saveDB() { localStorage.setItem('restopro_v3', JSON.stringify(DB)); }

function daysAgo(n) {
  const d = new Date(); d.setDate(d.getDate() - n);
  return d.toISOString().split('T')[0];
}
function monthAgo(d) {
  const dt = new Date(); dt.setMonth(dt.getMonth()-1); dt.setDate(d);
  return dt.toISOString().split('T')[0];
}

function seed() {
  DB.suppliers = [
    {id:1,name:'×™×¨×§×™ ×”×›×¨××œ',   category:'×™×¨×§×•×ª ×•×¤×™×¨×•×ª',phone:'050-1234567',contact:'×™×•×¡×™ ×œ×•×™'},
    {id:2,name:'×›×¨××œ ×‘×©×¨×™×',   category:'×‘×©×¨ ×•×¢×•×£',   phone:'052-9876543',contact:'×“×•×“ ×›×”×Ÿ'},
    {id:3,name:'××œ-×’××œ ××©×§××•×ª',category:'××©×§××•×ª',     phone:'054-5557777',contact:'××™×¨×™ ××‘×¨×”×'},
    {id:4,name:'×˜×‘×¢ ×’×‘×™× ×•×ª',   category:'××•×¦×¨×™ ×—×œ×‘',  phone:'053-4443333',contact:'×©×¨×” ×œ×•×™'},
  ];
  DB.expenses = [
    {id:1,  date:daysAgo(0),  supplier:'×™×¨×§×™ ×”×›×¨××œ',   category:'×™×¨×§×•×ª ×•×¤×™×¨×•×ª',desc:'×¢×’×‘× ×™×•×ª ×•××œ×¤×¤×•× ×™×',amount:420},
    {id:2,  date:daysAgo(1),  supplier:'×›×¨××œ ×‘×©×¨×™×',   category:'×‘×©×¨ ×•×¢×•×£',   desc:'×× ×˜×¨×™×§×•×˜ ×•×—×–×” ×¢×•×£', amount:2200},
    {id:3,  date:daysAgo(2),  supplier:'××œ-×’××œ ××©×§××•×ª',category:'××©×§××•×ª',     desc:'×©×ª×™×™×” ×§×œ×” ×•××™×¦×™×',  amount:680},
    {id:4,  date:daysAgo(4),  supplier:'×˜×‘×¢ ×’×‘×™× ×•×ª',   category:'××•×¦×¨×™ ×—×œ×‘',  desc:'×’×‘×™× ×•×ª ×•×©×× ×ª',      amount:540},
    {id:5,  date:daysAgo(6),  supplier:'×™×¨×§×™ ×”×›×¨××œ',   category:'×™×¨×§×•×ª ×•×¤×™×¨×•×ª',desc:'×¤×™×¨×•×ª ×¢×•× ×”',        amount:310},
    {id:6,  date:daysAgo(8),  supplier:'×›×¨××œ ×‘×©×¨×™×',   category:'×‘×©×¨ ×•×¢×•×£',   desc:'×›×‘×© ×˜×¨×™',           amount:1800},
    {id:7,  date:daysAgo(10), supplier:'××œ-×’××œ ××©×§××•×ª',category:'××©×§××•×ª',     desc:'×‘×™×¨×” ×•×™×™×Ÿ',         amount:950},
    {id:8,  date:daysAgo(12), supplier:'×™×¨×§×™ ×”×›×¨××œ',   category:'×™×¨×§×•×ª ×•×¤×™×¨×•×ª',desc:'×™×¨×§×•×ª ×©×•×¨×©',        amount:280},
    {id:9,  date:monthAgo(5), supplier:'×›×¨××œ ×‘×©×¨×™×',   category:'×‘×©×¨ ×•×¢×•×£',   desc:'×”×–×× ×” ×—×•×“×©×™×ª',      amount:3100},
    {id:10, date:monthAgo(10),supplier:'×™×¨×§×™ ×”×›×¨××œ',   category:'×™×¨×§×•×ª ×•×¤×™×¨×•×ª',desc:'×™×¨×§×•×ª ×¢×œ×™×',        amount:1200},
    {id:11, date:monthAgo(15),supplier:'××œ-×’××œ ××©×§××•×ª',category:'××©×§××•×ª',     desc:'×¡×•×“×”',              amount:430},
    {id:12, date:monthAgo(20),supplier:'×˜×‘×¢ ×’×‘×™× ×•×ª',   category:'××•×¦×¨×™ ×—×œ×‘',  desc:'×—×œ×‘ ×•××•×¦×¨×™×•',       amount:780},
  ];
  DB.orders = [
    {id:1,supplier:'×™×¨×§×™ ×”×›×¨××œ',   date:daysAgo(3),status:'received',
     items:[{name:'×¢×’×‘× ×™×•×ª',qty:10,unit:'×§"×’',price:8,total:80},{name:'××œ×¤×¤×•× ×™×',qty:5,unit:'×§"×’',price:6,total:30}],total:110},
    {id:2,supplier:'×›×¨××œ ×‘×©×¨×™×',   date:daysAgo(1),status:'sent',
     items:[{name:'×× ×˜×¨×™×§×•×˜',qty:8,unit:'×§"×’',price:120,total:960},{name:'×—×–×” ×¢×•×£',qty:10,unit:'×§"×’',price:35,total:350}],total:1310},
    {id:3,supplier:'××œ-×’××œ ××©×§××•×ª',date:daysAgo(0),status:'draft',
     items:[{name:'×§×•×œ×” 1.5L',qty:24,unit:'×‘×§×‘×•×§×™×',price:5,total:120}],total:120},
  ];
  saveDB();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const pgNames = {dashboard:'×“×©×‘×•×¨×“',expenses:'××¢×§×‘ ×”×•×¦××•×ª',orders:'×”×–×× ×•×ª ×¡×¤×§×™×',suppliers:'×¡×¤×§×™×',settings:'×”×’×“×¨×•×ª'};

function go(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sb-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  document.querySelector(`[data-page="${name}"]`)?.classList.add('active');
  document.getElementById('pgName').textContent = pgNames[name];
  if (name === 'dashboard') renderDash();
  if (name === 'expenses')  renderExp();
  if (name === 'orders')    renderOrders();
  if (name === 'suppliers') renderSuppliers();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let chartBar, chartDon;

function renderDash() {
  const today    = new Date().toISOString().split('T')[0];
  const thisM    = today.slice(0,7);
  const lastM    = (() => { const d=new Date(); d.setMonth(d.getMonth()-1); return d.toISOString().slice(0,7); })();
  const mExp     = DB.expenses.filter(e => e.date.startsWith(thisM));
  const lmExp    = DB.expenses.filter(e => e.date.startsWith(lastM));
  const dExp     = DB.expenses.filter(e => e.date === today);
  const openOrd  = DB.orders.filter(o => o.status !== 'received');

  const mTot  = mExp.reduce((s,e) => s+e.amount, 0);
  const lmTot = lmExp.reduce((s,e) => s+e.amount, 0);
  const dTot  = dExp.reduce((s,e) => s+e.amount, 0);

  // top supplier this month
  const bySup = {};
  mExp.forEach(e => bySup[e.supplier] = (bySup[e.supplier]||0) + e.amount);
  const top   = Object.entries(bySup).sort((a,b) => b[1]-a[1])[0];
  const diff  = lmTot ? Math.round((mTot - lmTot) / lmTot * 100) : 0;

  document.getElementById('kM').textContent    = 'â‚ª' + mTot.toLocaleString('he-IL');
  document.getElementById('kD').textContent    = 'â‚ª' + dTot.toLocaleString('he-IL');
  document.getElementById('kO').textContent    = openOrd.length;
  document.getElementById('kS').textContent    = top?.[0] || 'â€”';
  document.getElementById('kSa').textContent   = top ? 'â‚ª' + top[1].toLocaleString() : '';
  document.getElementById('kMsub').textContent = diff > 0 ? `â†‘ ${diff}% ××—×•×“×© ×©×¢×‘×¨` : diff < 0 ? `â†“ ${Math.abs(diff)}% ××—×•×“×© ×©×¢×‘×¨` : '×–×”×” ×œ×—×•×“×© ×©×¢×‘×¨';

  // Bar chart â€“ 6 months
  const labels=[], vals=[];
  for (let i=5; i>=0; i--) {
    const d = new Date(); d.setMonth(d.getMonth()-i);
    const k = d.toISOString().slice(0,7);
    labels.push(d.toLocaleDateString('he-IL',{month:'short',year:'2-digit'}));
    vals.push(DB.expenses.filter(e => e.date.startsWith(k)).reduce((s,e) => s+e.amount, 0));
  }
  if (chartBar) chartBar.destroy();
  chartBar = new Chart(document.getElementById('cBar'), {
    type: 'bar',
    data: { labels, datasets:[{ data:vals, backgroundColor:'rgba(245,158,11,.75)', borderRadius:7, borderSkipped:false }]},
    options: { responsive:true, plugins:{ legend:{display:false} },
      scales:{ y:{ beginAtZero:true, ticks:{ callback:v=>'â‚ª'+v.toLocaleString(), color:'#A1A1AA' }, grid:{color:'#F4F4F5'} },
               x:{ ticks:{color:'#A1A1AA'}, grid:{display:false} } } }
  });

  // Doughnut â€“ categories
  const catMap = {};
  mExp.forEach(e => catMap[e.category] = (catMap[e.category]||0) + e.amount);
  if (chartDon) chartDon.destroy();
  if (Object.keys(catMap).length) {
    chartDon = new Chart(document.getElementById('cDon'), {
      type: 'doughnut',
      data: { labels: Object.keys(catMap), datasets:[{
        data: Object.values(catMap),
        backgroundColor:['#10B981','#EF4444','#3B82F6','#F59E0B','#8B5CF6'],
        borderWidth: 3, borderColor:'#FFFFFF'
      }]},
      options:{ responsive:true, cutout:'62%',
        plugins:{ legend:{ position:'bottom', labels:{ color:'#52525B', padding:12, font:{size:11} } } } }
    });
  }

  // Recent expenses
  const recent = [...DB.expenses].sort((a,b) => b.date.localeCompare(a.date)).slice(0,5);
  document.getElementById('recentBody').innerHTML = recent.map(e => `
    <tr>
      <td>${fmt(e.date)}</td>
      <td><b>${e.supplier}</b></td>
      <td>${catTag(e.category)}</td>
      <td style="color:var(--text3);font-size:.79rem">${e.desc||'â€”'}</td>
      <td class="amt">â‚ª${e.amount.toLocaleString('he-IL')}</td>
    </tr>`).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPENSES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderExp() {
  const m   = document.getElementById('fMonth').value;
  const cat = document.getElementById('fCat').value;
  const q   = document.getElementById('fQ').value.toLowerCase();
  let data  = [...DB.expenses].sort((a,b) => b.date.localeCompare(a.date));
  if (m)   data = data.filter(e => e.date.startsWith(m));
  if (cat) data = data.filter(e => e.category === cat);
  if (q)   data = data.filter(e => (e.supplier+e.desc+e.category).toLowerCase().includes(q));

  document.getElementById('expCount').textContent = `${data.length} ×”×•×¦××•×ª`;
  document.getElementById('expEmpty').style.display = data.length ? 'none' : 'block';
  document.getElementById('expBody').innerHTML = data.map(e => `
    <tr>
      <td>${fmt(e.date)}</td>
      <td><b>${e.supplier}</b></td>
      <td>${catTag(e.category)}</td>
      <td style="color:var(--text3);font-size:.79rem">${e.desc||'â€”'}</td>
      <td class="amt">â‚ª${e.amount.toLocaleString('he-IL')}</td>
      <td>
        <button class="ib" onclick="editExp(${e.id})" title="×¢×¨×™×›×”">âœï¸</button>
        <button class="ib del" onclick="delExp(${e.id})" title="××—×™×§×”">ğŸ—‘ï¸</button>
      </td>
    </tr>`).join('');
}

function openExpModal(id=null) {
  fillDL('dlSupp');
  document.getElementById('eEditId').value = id||'';
  document.getElementById('expModalTitle').textContent = id ? '×¢×¨×™×›×ª ×”×•×¦××”' : '×”×•×¦××” ×—×“×©×”';
  if (id) {
    const e = DB.expenses.find(x => x.id===id);
    document.getElementById('eDate').value = e.date;
    document.getElementById('eAmt').value  = e.amount;
    document.getElementById('eSupp').value = e.supplier;
    document.getElementById('eCat').value  = e.category;
    document.getElementById('eDesc').value = e.desc||'';
  } else {
    document.getElementById('eDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('eAmt').value  = '';
    document.getElementById('eSupp').value = '';
    document.getElementById('eDesc').value = '';
  }
  om('ovExp');
}
function editExp(id) { openExpModal(id); }

function saveExp() {
  const id  = document.getElementById('eEditId').value;
  const sup = document.getElementById('eSupp').value.trim();
  const amt = parseFloat(document.getElementById('eAmt').value)||0;
  const dt  = document.getElementById('eDate').value;
  if (!sup||!amt||!dt) { alert('×× × ××œ× ××ª ×›×œ ×©×“×•×ª ×”×—×•×‘×”'); return; }
  const obj = { id:id?+id:Date.now(), date:dt, supplier:sup,
    category:document.getElementById('eCat').value,
    desc:document.getElementById('eDesc').value.trim(), amount:amt };
  if (id) DB.expenses = DB.expenses.map(x => x.id===+id ? obj : x);
  else    DB.expenses.push(obj);
  saveDB(); cm('ovExp'); renderExp();
}
function delExp(id) {
  if (!confirm('×œ××—×•×§ ×”×•×¦××” ×–×•?')) return;
  DB.expenses = DB.expenses.filter(e => e.id!==id);
  saveDB(); renderExp();
}

function exportCSV() {
  const rows = [['×ª××¨×™×š','×¡×¤×§','×§×˜×’×•×¨×™×”','×ª×™××•×¨','×¡×›×•×']];
  DB.expenses.forEach(e => rows.push([e.date,e.supplier,e.category,e.desc||'',e.amount]));
  const csv = '\uFEFF' + rows.map(r=>r.join(',')).join('\n');
  const a = Object.assign(document.createElement('a'), {href:'data:text/csv;charset=utf-8,'+encodeURIComponent(csv),download:'expenses.csv'});
  a.click();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ORDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderOrders() {
  const sorted = [...DB.orders].sort((a,b) => b.date.localeCompare(a.date));
  document.getElementById('ordEmpty').style.display = sorted.length ? 'none' : 'block';
  const slbl = {draft:'×˜×™×•×˜×”',sent:'× ×©×œ×—×”',received:'×”×ª×§×‘×œ×”'};
  const scls = {draft:'st-draft',sent:'st-sent',received:'st-received'};
  document.getElementById('ordGrid').innerHTML = sorted.map(o => `
    <div class="ord-card">
      <div class="ord-top">
        <div>
          <div class="ord-sup">${o.supplier}</div>
          <div class="ord-dt">${fmt(o.date)}</div>
        </div>
        <span class="stag ${scls[o.status]}">${slbl[o.status]}</span>
      </div>
      <div>
        ${o.items.slice(0,4).map(i=>`
          <div class="ord-line">
            <span>${i.name} Ã— ${i.qty} ${i.unit||''}</span>
            <span style="font-weight:600">â‚ª${i.total.toLocaleString()}</span>
          </div>`).join('')}
        ${o.items.length>4?`<div style="font-size:.73rem;color:var(--text3);padding-top:3px">...×•×¢×•×“ ${o.items.length-4} ×¤×¨×™×˜×™×</div>`:''}
      </div>
      <div class="ord-total">
        <span class="ord-tl">×¡×”"×› ×”×–×× ×”</span>
        <span class="ord-tv">â‚ª${o.total.toLocaleString('he-IL')}</span>
      </div>
      <div class="ord-acts">
        ${o.status!=='received'
          ? `<button class="btn btn-out btn-sm" style="flex:1" onclick="markRcv(${o.id})">âœ“ ×¡××Ÿ ×›×”×ª×§×‘×œ</button>`
          : `<button class="btn btn-ghost btn-sm" disabled style="flex:1;color:var(--green)">âœ“ ×”×ª×§×‘×œ</button>`}
        <button class="ib del" onclick="delOrder(${o.id})">ğŸ—‘ï¸</button>
      </div>
    </div>`).join('');
}
function markRcv(id) { DB.orders = DB.orders.map(o => o.id===id ? {...o,status:'received'} : o); saveDB(); renderOrders(); }
function delOrder(id) { if(!confirm('×œ××—×•×§ ×”×–×× ×”?')) return; DB.orders=DB.orders.filter(o=>o.id!==id); saveDB(); renderOrders(); }

// â”€â”€ Manual Order â”€â”€
let manRows = [];
function openManualOrder() {
  fillDL('dlSupp2');
  manRows = [{name:'',qty:1,unit:'×™×—\'',price:0,total:0}];
  document.getElementById('manSupp').value = '';
  document.getElementById('manDate').value = new Date().toISOString().split('T')[0];
  renderManRows(); om('ovMan');
}
function renderManRows() {
  document.getElementById('manItems').innerHTML = manRows.map((r,i) => `
    <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr auto;gap:5px;margin-bottom:5px;align-items:center">
      <input class="fc" style="font-size:.79rem;padding:7px 9px" placeholder="×©× ×¤×¨×™×˜" value="${r.name}"
        oninput="manRows[${i}].name=this.value">
      <input class="fc" type="number" style="font-size:.79rem;padding:7px 9px" placeholder="×›××•×ª" value="${r.qty}"
        oninput="manRows[${i}].qty=+this.value;calcMan(${i})">
      <input class="fc" style="font-size:.79rem;padding:7px 9px" placeholder="×™×—×™×“×”" value="${r.unit}"
        oninput="manRows[${i}].unit=this.value">
      <input class="fc" type="number" style="font-size:.79rem;padding:7px 9px" placeholder="××—×™×¨" value="${r.price}"
        oninput="manRows[${i}].price=+this.value;calcMan(${i})">
      <button class="ib del" onclick="manRows.splice(${i},1);renderManRows()">âœ•</button>
    </div>`).join('');
  updManTot();
}
function addManRow()   { manRows.push({name:'',qty:1,unit:'×™×—\'',price:0,total:0}); renderManRows(); }
function calcMan(i)    { manRows[i].total = manRows[i].qty * manRows[i].price; updManTot(); }
function updManTot()   { document.getElementById('manTot').textContent = '×¡×”"×›: â‚ª' + manRows.reduce((s,r)=>s+r.total,0).toLocaleString('he-IL'); }

function saveManOrder(status) {
  const sup = document.getElementById('manSupp').value.trim();
  if (!sup) { alert('×× × ×”×–×Ÿ ×©× ×¡×¤×§'); return; }
  const items = manRows.filter(r => r.name.trim());
  if (!items.length) { alert('×”×•×¡×£ ×œ×¤×—×•×ª ×¤×¨×™×˜ ××—×“'); return; }
  DB.orders.push({ id:Date.now(), supplier:sup, date:document.getElementById('manDate').value,
    status, items, total:items.reduce((s,r)=>s+r.total,0) });
  saveDB(); cm('ovMan'); renderOrders();
}

// â”€â”€ AI Order â”€â”€
let aiRows = [];
function openAIOrder() {
  fillDL('dlSupp3');
  aiRows = [];
  document.getElementById('aiSupp').value = '';
  document.getElementById('prevPic').style.display = 'none';
  document.getElementById('aiRes').style.display = 'none';
  document.getElementById('aiConfirm').style.display = 'none';
  document.getElementById('analyzeBtn').disabled = true;
  document.getElementById('menuFile').value = '';
  om('ovAI');
}
function prevImg(inp) {
  const f = inp.files[0]; if (!f) return;
  const r = new FileReader();
  r.onload = e => {
    const img = document.getElementById('prevPic');
    img.src = e.target.result; img.style.display = 'block';
    document.getElementById('analyzeBtn').disabled = false;
  };
  r.readAsDataURL(f);
}
async function runAI() {
  if (!DB.apiKey) { alert('×”×’×“×¨ ××¤×ª×— Claude API ×‘×”×’×“×¨×•×ª'); return; }
  const f = document.getElementById('menuFile').files[0];
  if (!f) { alert('×× × ×”×¢×œ×” ×ª××•× ×”'); return; }
  const btn = document.getElementById('analyzeBtn');
  btn.classList.add('loading'); btn.disabled = true;
  try {
    const b64 = await new Promise((res,rej) => {
      const r = new FileReader();
      r.onload  = () => res(r.result.split(',')[1]);
      r.onerror = rej; r.readAsDataURL(f);
    });
    const resp = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':DB.apiKey,'anthropic-version':'2023-06-01'},
      body: JSON.stringify({ model:'claude-sonnet-4-6', max_tokens:1500,
        messages:[{ role:'user', content:[
          { type:'image', source:{ type:'base64', media_type:f.type, data:b64 }},
          { type:'text',  text:'× ×ª×— ××ª ×ª××•× ×ª ×”×ª×¤×¨×™×˜/×§×˜×œ×•×’ ×”×¡×¤×§. ×”×—×–×¨ JSON ×‘×œ×‘×“ ×œ×œ× markdown:\n{"items":[{"name":"×©× ××•×¦×¨","qty":×›××•×ª_××•×¦×¢×ª,"unit":"×™×—×™×“×”","price":××—×™×¨}]}\n×¢×“ 15 ×¤×¨×™×˜×™×. ×× ××—×™×¨ ×œ× ×™×“×•×¢ ×”×©×ª××© ×‘-0.' }
        ]}]
      })
    });
    if (!resp.ok) { const e=await resp.json(); throw new Error(e.error?.message||'×©×’×™××ª API'); }
    const data = await resp.json();
    let parsed;
    try { parsed = JSON.parse(data.content[0].text.replace(/```json|```/g,'')); }
    catch { const m = data.content[0].text.match(/\[[\s\S]*\]/); parsed = { items: m ? JSON.parse(m[0]) : [] }; }
    aiRows = (parsed.items||[]).map(it => ({
      name:it.name||'', qty:it.qty||1, unit:it.unit||'×™×—\'',
      price:it.price||0, total:(it.qty||1)*(it.price||0)
    }));
    renderAIRows();
    document.getElementById('aiRes').style.display = 'block';
    document.getElementById('aiConfirm').style.display = 'inline-flex';
  } catch(e) {
    alert('×©×’×™××”: ' + e.message);
  } finally {
    btn.classList.remove('loading'); btn.disabled = false;
  }
}
function renderAIRows() {
  document.getElementById('aiList').innerHTML = aiRows.map((r,i) => `
    <div class="ai-row">
      <input class="fc" style="font-size:.79rem;padding:7px 9px" value="${r.name}"
        oninput="aiRows[${i}].name=this.value">
      <input class="fc" type="number" style="font-size:.79rem;padding:7px 9px" value="${r.qty}"
        oninput="aiRows[${i}].qty=+this.value;aiRows[${i}].total=aiRows[${i}].qty*aiRows[${i}].price;renderAIRows()">
      <input class="fc" style="font-size:.79rem;padding:7px 9px" value="${r.unit}"
        oninput="aiRows[${i}].unit=this.value">
      <input class="fc" type="number" style="font-size:.79rem;padding:7px 9px" value="${r.price}"
        oninput="aiRows[${i}].price=+this.value;aiRows[${i}].total=aiRows[${i}].qty*aiRows[${i}].price;renderAIRows()">
      <button class="ib del" onclick="aiRows.splice(${i},1);renderAIRows()">âœ•</button>
    </div>`).join('');
  document.getElementById('aiTot').textContent = '×¡×”"×›: â‚ª' + aiRows.reduce((s,r)=>s+r.total,0).toLocaleString('he-IL');
}
function confirmAIOrder() {
  const sup = document.getElementById('aiSupp').value.trim() || '×¡×¤×§ ×œ× ×™×“×•×¢';
  const items = aiRows.filter(r => r.name.trim());
  DB.orders.push({ id:Date.now(), supplier:sup, date:new Date().toISOString().split('T')[0],
    status:'draft', items, total:items.reduce((s,r)=>s+r.total,0) });
  saveDB(); cm('ovAI'); go('orders');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUPPLIERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderSuppliers() {
  const emo = {'×™×¨×§×•×ª ×•×¤×™×¨×•×ª':'ğŸ¥¦','×‘×©×¨ ×•×¢×•×£':'ğŸ¥©','××©×§××•×ª':'ğŸ¥¤','××•×¦×¨×™ ×—×œ×‘':'ğŸ§€','××—×¨':'ğŸ“¦'};
  document.getElementById('supEmpty').style.display = DB.suppliers.length ? 'none' : 'block';
  document.getElementById('supGrid').innerHTML = DB.suppliers.map(s => {
    const total = DB.expenses.filter(e=>e.supplier===s.name).reduce((sum,e)=>sum+e.amount,0);
    return `
    <div class="sup-card">
      <div class="sup-av">${emo[s.category]||'ğŸ“¦'}</div>
      <div class="sup-name">${s.name}</div>
      <div style="margin-top:4px">${catTag(s.category)}</div>
      ${s.phone   ? `<div class="sup-meta" style="margin-top:7px">ğŸ“ ${s.phone}</div>` : ''}
      ${s.contact ? `<div class="sup-meta">ğŸ‘¤ ${s.contact}</div>` : ''}
      <div class="sup-tot">
        <span class="sup-tl">×¡×”"×› ×§× ×™×•×ª</span>
        <span class="sup-tv">â‚ª${total.toLocaleString('he-IL')}</span>
      </div>
      <div class="sup-acts">
        <button class="btn btn-out btn-sm" style="flex:1" onclick="editSup(${s.id})">âœï¸ ×¢×¨×•×š</button>
        <button class="ib del" onclick="delSup(${s.id})">ğŸ—‘ï¸</button>
      </div>
    </div>`;
  }).join('');
}
function openSupModal(id=null) {
  document.getElementById('supEditId').value = id||'';
  document.getElementById('supModalTitle').textContent = id ? '×¢×¨×™×›×ª ×¡×¤×§' : '×¡×¤×§ ×—×“×©';
  if (id) {
    const s = DB.suppliers.find(x=>x.id===id);
    document.getElementById('sName').value    = s.name;
    document.getElementById('sCat').value     = s.category;
    document.getElementById('sPhone').value   = s.phone||'';
    document.getElementById('sContact').value = s.contact||'';
  } else {
    ['sName','sPhone','sContact'].forEach(id => document.getElementById(id).value='');
  }
  om('ovSup');
}
function editSup(id) { openSupModal(id); }
function saveSup() {
  const id   = document.getElementById('supEditId').value;
  const name = document.getElementById('sName').value.trim();
  if (!name) { alert('×× × ×”×–×Ÿ ×©× ×¡×¤×§'); return; }
  const obj = { id:id?+id:Date.now(), name, category:document.getElementById('sCat').value,
    phone:document.getElementById('sPhone').value.trim(), contact:document.getElementById('sContact').value.trim() };
  if (id) DB.suppliers = DB.suppliers.map(x => x.id===+id ? obj : x);
  else    DB.suppliers.push(obj);
  saveDB(); cm('ovSup'); renderSuppliers();
}
function delSup(id) {
  if (!confirm('×œ××—×•×§ ×¡×¤×§ ×–×”?')) return;
  DB.suppliers = DB.suppliers.filter(s => s.id!==id);
  saveDB(); renderSuppliers();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveKey() {
  DB.apiKey = document.getElementById('apiIn').value.trim();
  saveDB(); updateApiStatus();
  const t = document.getElementById('keyToast');
  t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2500);
}
function nukeData() {
  if (!confirm('××—×™×§×ª ×›×œ ×”× ×ª×•× ×™×? ×¤×¢×•×œ×” ×‘×œ×ª×™ ×”×¤×™×›×”!')) return;
  localStorage.removeItem('restopro_v3'); location.reload();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function om(id)  { document.getElementById(id).classList.add('open'); }
function cm(id)  { document.getElementById(id).classList.remove('open'); }

function fmt(s) {
  if (!s) return 'â€”';
  return new Date(s+'T12:00:00').toLocaleDateString('he-IL',{day:'2-digit',month:'2-digit',year:'numeric'});
}

function catTag(cat) {
  const m = {'×™×¨×§×•×ª ×•×¤×™×¨×•×ª':'tag-v','×‘×©×¨ ×•×¢×•×£':'tag-m','××©×§××•×ª':'tag-d','××•×¦×¨×™ ×—×œ×‘':'tag-l'};
  return `<span class="tag ${m[cat]||'tag-o'}">${cat}</span>`;
}

function updateApiStatus() {
  const ok = !!DB.apiKey;
  document.getElementById('apiDot').className = 'api-dot' + (ok?' ok':'');
  document.getElementById('apiLbl').textContent = ok ? 'Claude API ××—×•×‘×¨ âœ“' : 'Claude API ×œ× ××•×’×“×¨';
  if (ok) document.getElementById('apiBanner')?.remove();
}

function fillDL(id) {
  document.getElementById(id).innerHTML = DB.suppliers.map(s=>`<option value="${s.name}">`).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
loadDB();
document.getElementById('tDate').textContent =
  new Date().toLocaleDateString('he-IL',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
document.getElementById('fMonth').value = new Date().toISOString().slice(0,7);
document.getElementById('apiIn').value  = DB.apiKey||'';
updateApiStatus();
renderDash();

// close modal on overlay click
document.querySelectorAll('.overlay').forEach(ov =>
  ov.addEventListener('click', e => { if (e.target===ov) ov.classList.remove('open'); })
);
</script>
</body>
</html>
